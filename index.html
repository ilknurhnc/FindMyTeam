<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find My Team</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="src/style.css">
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3>Spor Arkadaşı Yükleniyor...</h3>
        </div>
    </div>

    <div class="bg-animation">
        <div class="floating-shape"></div>
        <div class="floating-shape"></div>
        <div class="floating-shape"></div>
        <div class="floating-shape"></div>
    </div>

    <div id="app"></div>

    <script>
        // API URL (Backend bağlantısı için)
        const API_URL = 'https://localhost:7001/api';

        // Sayfa şablonları
        const pages = {
            login: ''
            ,

            register: ''
            ,

            home: ''
            ,

            create: ''
            ,

            map: ''
            ,

            profile: ''
        };

        // Uygulama durumu
        let currentUser = null;
        let events = [];

        // Spor ikonu mapping
        const sportIcons = {
            football: '⚽',
            basketball: '🏀',
            volleyball: '🏐',
            tennis: '🎾',
            running: '🏃‍♂️',
            cycling: '🚴‍♂️',
            swimming: '🏊‍♂️',
            badminton: '🏸'
        };

        // Seviye mapping
        const skillLevels = {
            beginner: '🌱 Başlangıç',
            intermediate: '⭐ Orta',
            advanced: '🏆 İleri',
            mixed: '🎯 Karma'
        };

        // Bildirim sistemi
        function showNotification(message, type = 'success') {
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();

            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 400);
            }, 4000);
        }

        // Loading ekranı
        function hideLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
                setTimeout(() => loadingScreen.remove(), 500);
            }, 1000);
        }

        // Sayfa navigasyonu
        function navigateTo(page) {
            const app = document.getElementById('app');
            
            if (!currentUser && !['login', 'register'].includes(page)) {
                page = 'login';
            }
            
            app.innerHTML = pages[page] || pages.login;
            setupPageEvents(page);
            window.location.hash = page;
        }

        // Sayfa event'leri
        function setupPageEvents(page) {
            switch(page) {
                case 'login':
                    setupAuthEvents();
                    break;
                case 'register':
                    setupAuthEvents();
                    break;
                case 'home':
                    setupHomeEvents();
                    loadEvents();
                    break;
                case 'create':
                    setupCreateEvents();
                    break;
                case 'profile':
                    setupProfileEvents();
                    break;
            }
            
            setupNavigationEvents();
        }

        // Auth sayfası event'leri
        function setupAuthEvents() {
            // Tab switching
            document.querySelectorAll('[data-tab]').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    navigateTo(e.target.dataset.tab);
                });
            });

            // Login form
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const submitBtn = loginForm.querySelector('button[type="submit"]');
                    submitBtn.classList.add('btn-loading');
                    
                    const formData = new FormData(loginForm);
                    const email = formData.get('email') || loginForm.querySelector('input[type="email"]').value;
                    const password = formData.get('password') || loginForm.querySelector('input[type="password"]').value;
                    
                    try {
                        const response = await api.login(email, password);
                        
                        if (response.success) {
                            currentUser = response.user;
                            localStorage.setItem('token', response.token);
                            localStorage.setItem('user', JSON.stringify(response.user));
                            
                            showNotification('🎉 Hoş geldiniz! Giriş başarılı.');
                            setTimeout(() => navigateTo('home'), 1000);
                        }
                    } catch (error) {
                        showNotification('❌ Giriş yapılamadı. Lütfen bilgilerinizi kontrol edin.', 'error');
                    } finally {
                        submitBtn.classList.remove('btn-loading');
                    }
                });
            }

            // Register form
            const registerForm = document.getElementById('registerForm');
            if (registerForm) {
                registerForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const submitBtn = registerForm.querySelector('button[type="submit"]');
                    const inputs = registerForm.querySelectorAll('input');
                    const passwords = registerForm.querySelectorAll('input[type="password"]');
                    
                    // Şifre kontrolü
                    if (passwords[0].value !== passwords[1].value) {
                        showNotification('❌ Şifreler eşleşmiyor!', 'error');
                        return;
                    }
                    
                    if (passwords[0].value.length < 6) {
                        showNotification('❌ Şifre en az 6 karakter olmalı!', 'error');
                        return;
                    }
                    
                    submitBtn.classList.add('btn-loading');
                    
                    const userData = {
                        name: inputs[0].value,
                        email: inputs[1].value,
                        password: inputs[2].value
                    };
                    
                    try {
                        const response = await api.register(userData);
                        
                        if (response.success) {
                            showNotification('✅ Kayıt başarılı! Şimdi giriş yapabilirsiniz.');
                            setTimeout(() => navigateTo('login'), 1500);
                        }
                    } catch (error) {
                        showNotification('❌ Kayıt işlemi başarısız. Lütfen tekrar deneyin.', 'error');
                    } finally {
                        submitBtn.classList.remove('btn-loading');
                    }
                });
            }
        }

        // Ana sayfa event'leri
        function setupHomeEvents() {
            // İstatistikleri güncelle
            setTimeout(() => {
                document.getElementById('activeEvents').textContent = '12';
                document.getElementById('totalUsers').textContent = '247';
            }, 1000);
        }

        // Etkinlikleri yükle
        async function loadEvents() {
            try {
                events = await api.getEvents();
                renderEvents(events);
            } catch (error) {
                showNotification('❌ Etkinlikler yüklenemedi.', 'error');
            }
        }

        // Etkinlikleri render et
        function renderEvents(eventsData) {
            const eventsGrid = document.getElementById('eventsGrid');
            if (!eventsGrid) return;

            eventsGrid.innerHTML = eventsData.map(event => {
                const eventDate = new Date(event.eventDate);
                const formattedDate = eventDate.toLocaleDateString('tr-TR', {
                    day: 'numeric',
                    month: 'long',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                return `
                    <div class="event-card" data-event-id="${event.id}">
                        <div class="event-header">
                            <div class="event-icon">
                                ${sportIcons[event.sportType] || '🏃‍♂️'}
                            </div>
                            <h3 class="event-title">${event.title}</h3>
                        </div>
                        
                        <div class="event-details">
                            <div class="event-detail">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${event.location}</span>
                            </div>
                            <div class="event-detail">
                                <i class="fas fa-clock"></i>
                                <span>${formattedDate}</span>
                            </div>
                            <div class="event-detail">
                                <i class="fas fa-users"></i>
                                <span>${event.currentParticipants}/${event.maxParticipants} kişi</span>
                            </div>
                            <div class="event-detail">
                                <i class="fas fa-chart-bar"></i>
                                <span>${skillLevels[event.skillLevel]}</span>
                            </div>
                            <div class="event-detail">
                                <i class="fas fa-user-circle"></i>
                                <span>Organizatör: ${event.creatorName}</span>
                            </div>
                        </div>
                        
                        <div class="event-actions">
                            <button class="action-btn join-btn" onclick="joinEvent(${event.id})">
                                <i class="fas fa-hand-rock"></i> Katıl
                            </button>
                            <button class="action-btn details-btn" onclick="showEventDetails(${event.id})">
                                <i class="fas fa-info-circle"></i> Detay
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Etkinliğe katıl
        async function joinEvent(eventId) {
            try {
                const response = await api.joinEvent(eventId);
                if (response.success) {
                    showNotification('🎉 Etkinliğe başarıyla katıldınız!');
                    // UI güncelle
                    const eventCard = document.querySelector(`[data-event-id="${eventId}"]`);
                    const joinBtn = eventCard.querySelector('.join-btn');
                    joinBtn.innerHTML = '<i class="fas fa-times"></i> Ayrıl';
                    joinBtn.classList.add('joined');
                    joinBtn.onclick = () => leaveEvent(eventId);
                }
            } catch (error) {
                showNotification('❌ Etkinliğe katılınamadı.', 'error');
            }
        }

        // Etkinlikten ayrıl
        async function leaveEvent(eventId) {
            try {
                showNotification('👋 Etkinlikten ayrıldınız.');
                // UI güncelle
                const eventCard = document.querySelector(`[data-event-id="${eventId}"]`);
                const joinBtn = eventCard.querySelector('.join-btn');
                joinBtn.innerHTML = '<i class="fas fa-hand-rock"></i> Katıl';
                joinBtn.classList.remove('joined');
                joinBtn.onclick = () => joinEvent(eventId);
            } catch (error) {
                showNotification('❌ İşlem başarısız.', 'error');
            }
        }

        // Etkinlik detaylarını göster
        function showEventDetails(eventId) {
            const event = events.find(e => e.id === eventId);
            if (event) {
                alert(`
Etkinlik: ${event.title}
Açıklama: ${event.description || 'Açıklama bulunmuyor.'}
Konum: ${event.location}
Tarih: ${new Date(event.eventDate).toLocaleString('tr-TR')}
Seviye: ${skillLevels[event.skillLevel]}
Katılımcılar: ${event.currentParticipants}/${event.maxParticipants}
Organizatör: ${event.creatorName}
                `);
            }
        }

        // Etkinlik oluşturma event'leri
        function setupCreateEvents() {
            const createForm = document.getElementById('createEventForm');
            if (createForm) {
                createForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const submitBtn = createForm.querySelector('button[type="submit"]');
                    submitBtn.classList.add('btn-loading');
                    
                    const formData = new FormData(createForm);
                    const eventData = {
                        title: formData.get('title'),
                        sportType: formData.get('sportType'),
                        location: formData.get('location'),
                        eventDate: formData.get('eventDate'),
                        maxParticipants: parseInt(formData.get('maxParticipants')),
                        skillLevel: formData.get('skillLevel'),
                        description: formData.get('description')
                    };
                    
                    try {
                        const response = await api.createEvent(eventData);
                        
                        if (response.success) {
                            showNotification('🚀 Etkinlik başarıyla oluşturuldu!');
                            setTimeout(() => navigateTo('home'), 1500);
                        }
                    } catch (error) {
                        showNotification('❌ Etkinlik oluşturulamadı.', 'error');
                    } finally {
                        submitBtn.classList.remove('btn-loading');
                    }
                });
            }
        }

        // Profil event'leri
        function setupProfileEvents() {
            if (currentUser) {
                document.getElementById('profileName').textContent = currentUser.name;
                document.getElementById('profileEmail').textContent = currentUser.email;
                
                // Mock istatistikler
                setTimeout(() => {
                    document.getElementById('joinedEvents').textContent = '5';
                    document.getElementById('createdEvents').textContent = '2';
                    document.getElementById('completedEvents').textContent = '3';
                    document.getElementById('sportFriends').textContent = '12';
                }, 500);
            }
        }

        // Navigation event'leri
        function setupNavigationEvents() {
            // Nav button'ları
            document.querySelectorAll('[data-page]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const page = e.target.dataset.page || e.target.closest('[data-page]').dataset.page;
                    navigateTo(page);
                });
            });
            
            // Logout button
            const logoutBtn = document.querySelector('.logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    currentUser = null;
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                    showNotification('👋 Başarıyla çıkış yaptınız.');
                    setTimeout(() => navigateTo('login'), 1000);
                });
            }
        }

        // Uygulama başlatma
        function initApp() {
            // Saklanan kullanıcıyı kontrol et
            const savedUser = localStorage.getItem('user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
            }
            
            // URL'den sayfa al
            const hash = window.location.hash.slice(1);
            const initialPage = hash || (currentUser ? 'home' : 'login');
            
            navigateTo(initialPage);
            hideLoadingScreen();
        }

        // Browser navigation
        window.addEventListener('hashchange', () => {
            const page = window.location.hash.slice(1) || (currentUser ? 'home' : 'login');
            navigateTo(page);
        });

        // Klavye kısayolları
        document.addEventListener('keydown', (e) => {
            if (!currentUser) return;
            
            if (e.altKey) {
                switch(e.key) {
                    case 'h':
                        e.preventDefault();
                        navigateTo('home');
                        break;
                    case 'c':
                        e.preventDefault();
                        navigateTo('create');
                        break;
                    case 'p':
                        e.preventDefault();
                        navigateTo('profile');
                        break;
                    case 'm':
                        e.preventDefault();
                        navigateTo('map');
                        break;
                }
            }
        });

        // Service worker için offline destek (isteğe bağlı)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            });
        }

        // Global fonksiyonlar (onclick için)
        window.joinEvent = joinEvent;
        window.leaveEvent = leaveEvent;
        window.showEventDetails = showEventDetails;

        // Uygulamayı başlat
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>